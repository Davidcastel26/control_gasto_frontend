<section class="space-y-6">
  <header>
    <h2 class="text-xl font-semibold">Transaction Inquiry</h2>
    <p class="text-sm text-slate-400">Consulta de movimientos por rango de fechas.</p>
  </header>

  <!-- Filtros -->
  <form [formGroup]="filterForm" class="grid grid-cols-1 md:grid-cols-4 gap-4" (ngSubmit)="load()">
    <div>
      <label class="block text-sm mb-1">Desde</label>
      <input
        type="date"
        class="w-full rounded-md bg-slate-900 border border-slate-700 px-3 py-2"
        formControlName="desde"
      />
    </div>
    <div>
      <label class="block text-sm mb-1">Hasta</label>
      <input
        type="date"
        class="w-full rounded-md bg-slate-900 border border-slate-700 px-3 py-2"
        formControlName="hasta"
      />
    </div>
    <div class="flex items-end gap-2">
      <button
        type="submit"
        class="px-3 py-2 rounded-md bg-sky-600 hover:bg-sky-500 text-sm font-medium"
        [disabled]="filterForm.invalid || isLoading()"
      >
        Buscar
      </button>
      @if (isLoading()) {
      <span class="text-xs text-slate-400">Cargando…</span>
      }
    </div>
  </form>

  <!-- Totales -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="rounded-lg border border-slate-800 bg-slate-950/40 p-4">
      <p class="text-xs text-slate-400">Depósitos</p>
      <p class="text-2xl font-semibold text-emerald-300">
        {{ totalDeposits() | number : '1.2-2' }}
      </p>
    </div>
    <div class="rounded-lg border border-slate-800 bg-slate-950/40 p-4">
      <p class="text-xs text-slate-400">Gastos</p>
      <p class="text-2xl font-semibold text-rose-300">
        {{ totalExpenses() | number : '1.2-2' }}
      </p>
    </div>
    <div class="rounded-lg border border-slate-800 bg-slate-950/40 p-4">
      <p class="text-xs text-slate-400">Saldo neto</p>
      <p
        class="text-2xl font-semibold"
        [ngClass]="netBalance() >= 0 ? 'text-emerald-300' : 'text-rose-300'"
      >
        {{ netBalance() | number : '1.2-2' }}
      </p>
    </div>
  </div>

  <!-- Mensaje de error -->
  @if (loadErrorMessage()) {
  <div class="rounded-md border border-rose-800 bg-rose-900/30 px-4 py-3 text-sm text-rose-200">
    {{ loadErrorMessage() }}
  </div>
  }

  <!-- Tabla -->
  <div class="rounded-lg border border-slate-800 overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-slate-900/70 text-slate-300 border-b border-slate-800">
        <tr>
          <th class="text-left px-4 py-2">Fecha</th>
          <th class="text-left px-4 py-2">Tipo</th>
          <th class="text-left px-4 py-2">Descripción</th>
          <th class="text-right px-4 py-2">Monto</th>
        </tr>
      </thead>
      <tbody>
        @if (isLoading()) {
        <tr>
          <td colspan="4" class="px-4 py-4">Cargando…</td>
        </tr>
        } @else if (movementItems().length === 0) {
        <tr>
          <td colspan="4" class="px-4 py-4 text-slate-400">Sin datos</td>
        </tr>
        } @else { @for (m of movementItems(); track trackByMovement) {
        <tr class="border-b border-slate-800">
          <td class="px-4 py-2">{{ m.fecha | date : 'yyyy-MM-dd' }}</td>
          <td class="px-4 py-2">
            <span
              class="px-2 py-0.5 rounded text-xs"
              [ngClass]="
                m.tipo === 1 ? 'bg-emerald-700/40 text-emerald-200' : 'bg-rose-700/40 text-rose-200'
              "
            >
              {{ m.tipo === 1 ? 'Depósito' : 'Gasto' }}
            </span>
          </td>
          <td class="px-4 py-2">{{ m.descripcion || '—' }}</td>
          <td class="px-4 py-2 text-right">{{ m.montoTotal | number : '1.2-2' }}</td>
        </tr>
        } }
      </tbody>
    </table>
  </div>
</section>
